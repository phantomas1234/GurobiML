Notebook[{

Cell[CellGroupData[{
Cell["GurobiML", "Section",
 InitializationGroup->True,
 CellChangeTimes->{{3.510327334403792*^9, 3.510327364910742*^9}, {
  3.512831053031672*^9, 3.5128310559631653`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"StringReplace", "[", 
    RowBox[{
     RowBox[{"FindFile", "[", "\"\<GurobiML`\>\"", "]"}], ",", 
     RowBox[{"\"\<Kernel/init.m\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}], "]"}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Uninstall", "[", "gurobiMLlink", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gurobiMLlink", "=", 
   RowBox[{"Install", "[", "\"\<GurobiML/GurobiML\>\"", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ResetDirectory", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{
  3.512999095739655*^9, {3.512999300558169*^9, 3.512999318717938*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<GurobiML`GurobiML`\>\"", "]"}], 
  ";"}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.510327274915954*^9, 3.510327283758245*^9}, 
   3.510331738279237*^9, {3.510332636511484*^9, 3.510332639509285*^9}, {
   3.512830984188418*^9, 3.5128310005635242`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolve", "::", "usage"}], "=", 
   "\"\<GurobiSolve provides the same function signature as Mathematica's own \
LinearProgramming function (check Mathematica's Help Center for documentation \
on how to use LinearProgramming).\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.512831031499298*^9, 3.512831039429185*^9}, {
   3.512837343212306*^9, 3.512837344044084*^9}, 3.512837411237502*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"matrix2compressedSparseRow", "::", "usage"}], "=", 
   "\"\<matrix2compressedSparseRow[matrix] translates matrix into condensed \
sparse row format (as described in Gurobi documentation).\>\""}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.512837346172017*^9, 3.512837407588661*^9}, 
   3.526827015042384*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"matrix2sparse", "::", "usage"}], "=", 
   "\"\<matrix2sparse[matrix] returns rowID, colID, Values ...\>\""}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.526826973698173*^9, 3.526827013762807*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolveMinimaMaxima", "::", "usage"}], "=", "\"\<...\>\""}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.5103273060361433`*^9, 3.5103273060373793`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GurobiML", "::", "badargs"}], "=", 
  "\"\<There is no definition for '``' applicable to ``.\>\""}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"matrix2compressedSparseRow", "[", 
    RowBox[{"mat_", "?", "MatrixQ"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rind", ",", "cind", ",", "cval", ",", "cbeg"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"rind", ",", "cind", ",", "cval"}], "}"}], "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ArrayRules", "[", 
           RowBox[{"SparseArray", "[", "mat", "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{";;", 
            RowBox[{"-", "2"}]}], "]"}], "]"}], "/.", 
         RowBox[{"r_Rule", "\[RuleDelayed]", 
          RowBox[{"Append", "[", 
           RowBox[{
            RowBox[{"r", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"r", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cbeg", "=", 
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Accumulate", "[", 
           RowBox[{
            RowBox[{"Tally", "[", "rind", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{";;", 
            RowBox[{"-", "2"}]}], "]"}], "]"}], ",", "0"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"cbeg", ",", 
        RowBox[{"cind", "-", "1"}], ",", "cval"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"matrix2sparse", "[", 
   RowBox[{"mat_", "?", "MatrixQ"}], "]"}], ":=", 
  RowBox[{"Transpose", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Append", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "-", "1"}], ",", 
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", 
    RowBox[{
     RowBox[{"ArrayRules", "[", 
      RowBox[{"SparseArray", "[", "mat", "]"}], "]"}], "[", 
     RowBox[{"[", 
      RowBox[{";;", 
       RowBox[{"-", "2"}]}], "]"}], "]"}]}], "]"}]}]}], "Input",
 InitializationGroup->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "GurobiSolve", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolve", "::", "objerror"}], "=", 
   "\"\<Objective function `1` is wrongly specified. Needs to be either a \
list of coefficients (LP/MIP), a matrix representing quadratic terms in \
compressed sparse row format (QP), or both ({{_?NumberQ..}, \
_MatrixQ}).\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolve", "::", "rhserror"}], "=", 
   "\"\<Righthand sides `1` are wrongly specified.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolve", "::", "bndserror"}], "=", 
   "\"\<Variable bounds `1` are wrongly specified.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolve", "::", "domerror"}], "=", 
   "\"\<Problem with domain specification `1`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolve", "::", "lowlevelmessage"}], "=", 
   "\"\<Gurobi interface returned the following status: `1`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolve", "[", 
    RowBox[{
     RowBox[{"c", ":", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_", "?", "NumberQ"}], ".."}], "}"}], "|", 
        RowBox[{"_", "?", "MatrixQ"}], "|", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"_", "?", "NumberQ"}], ".."}], "}"}], ",", 
          RowBox[{"_", "?", "MatrixQ"}]}], "}"}]}], ")"}]}], ",", 
     RowBox[{"m_", "?", "MatrixQ"}], ",", 
     RowBox[{"b", ":", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"_", "?", "NumberQ"}], ".."}], "}"}], "|", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"_", "?", "NumberQ"}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "1"}], "|", 
               RowBox[{"-", "1."}], "|", "0", "|", "0.", "|", "1", "|", 
               "1."}], ")"}]}], "}"}], ".."}], "}"}]}], ")"}], ":", 
       RowBox[{"{", "}"}]}]}], ",", 
     RowBox[{"l", ":", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"_", "?", "NumberQ"}], "|", 
             RowBox[{"-", "\[Infinity]"}], "|", "\[Infinity]"}], ")"}], 
           ".."}], "}"}], "|", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"_", "?", "NumberQ"}], "|", 
               RowBox[{"-", "\[Infinity]"}], "|", "\[Infinity]"}], ")"}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"_", "?", "NumberQ"}], "|", 
               RowBox[{"-", "\[Infinity]"}], "|", "\[Infinity]"}], ")"}]}], 
            "}"}], ".."}], "}"}]}], ")"}], ":", 
       RowBox[{"{", "}"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"dom", ":", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Integers", "|", "Reals", "|", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"Integers", "|", "Reals"}], ")"}], ".."}], "}"}]}], ")"}],
        ":", "Reals"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "procRhs", ",", "procDom", ",", "lb", ",", "ub", ",", "senses", ",", 
       "cbeg", ",", "cind", ",", "cval", ",", "lClean"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"cbeg", ",", "cind", ",", "cval"}], "}"}], "=", 
       RowBox[{"matrix2compressedSparseRow", "[", "m", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"senses", "=", "\"\<\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"procRhs", "=", 
             RowBox[{"{", "}"}]}], ",", 
            RowBox[{"b", "\[Equal]", 
             RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"procRhs", "=", "b"}], ",", 
            RowBox[{"MatchQ", "[", 
             RowBox[{"b", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"_", "?", "NumberQ"}], ".."}], "}"}]}], "]"}]}], 
           "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"procRhs", ",", "senses"}], "}"}], "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"b", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
               RowBox[{"StringJoin", "[", 
                RowBox[{"Sequence", "@@", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"b", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "/.", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"0", "|", "0."}], ")"}], "\[Rule]", "\"\<=\>\""}],
                     ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "1"}], "|", 
                    RowBox[{"-", "1."}]}], ")"}], "\[Rule]", "\"\<<\>\""}], 
                    ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "|", "1."}], ")"}], "\[Rule]", 
                    "\"\<>\>\""}]}], "}"}]}], ")"}]}], "]"}]}], "}"}]}], ",", 
            
            RowBox[{"MatchQ", "[", 
             RowBox[{"b", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"_", "?", "NumberQ"}], ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"-", "1"}], "|", 
                    RowBox[{"-", "1."}], "|", "0", "|", "0.", "|", "1", "|", 
                    "1."}], ")"}]}], "}"}], ".."}], "}"}]}], "]"}]}], "}"}]}],
          "\[IndentingNewLine]", "}"}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"GurobiSolve", "::", "rhserror"}], ",", "b"}], "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<RHS: \>\"", ",", "procRhs"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Senses: \>\"", ",", "senses"}], "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"lClean", "=", 
       RowBox[{"l", "/.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "\[Infinity]"}], "\[Rule]", 
           RowBox[{"-", "10000"}]}], ",", 
          RowBox[{"\[Infinity]", "\[Rule]", "10000"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"lb", ",", "ub"}], "}"}], "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", "}"}], ",", 
               RowBox[{"{", "}"}]}], "}"}]}], ",", 
            RowBox[{"lClean", "\[Equal]", 
             RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"lb", ",", "ub"}], "}"}], "=", 
             RowBox[{"{", 
              RowBox[{"lClean", ",", 
               RowBox[{"{", "}"}]}], "}"}]}], ",", 
            RowBox[{"MatchQ", "[", 
             RowBox[{"lClean", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"_", "?", "NumberQ"}], ".."}], "}"}]}], "]"}]}], 
           "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"lb", ",", "ub"}], "}"}], "=", 
             RowBox[{"Transpose", "[", "lClean", "]"}]}], ",", 
            RowBox[{"MatchQ", "[", 
             RowBox[{"lClean", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"_", "?", "NumberQ"}], ",", 
                  RowBox[{"_", "?", "NumberQ"}]}], "}"}], ".."}], "}"}]}], 
             "]"}]}], "}"}]}], "\[IndentingNewLine]", "}"}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"GurobiSolve", "::", "bndserror"}], ",", "lClean"}], 
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<Lower bounds: \>\"", ",", "lb", ",", "\"\< Upper bounds: \>\"", 
          ",", "ub"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"procDom", "=", "\"\<NULL\>\""}], ",", 
            RowBox[{"dom", "\[Equal]", "Reals"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"procDom", "=", 
             RowBox[{"StringJoin", "[", 
              RowBox[{"Sequence", "@@", 
               RowBox[{"Table", "[", 
                RowBox[{"\"\<I\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"Length", "[", "c", "]"}], "}"}]}], "]"}]}], 
              "]"}]}], ",", 
            RowBox[{"dom", "\[Equal]", "Integers"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"procDom", "=", 
             RowBox[{"StringJoin", "[", 
              RowBox[{"Sequence", "@@", 
               RowBox[{"(", 
                RowBox[{"dom", "/.", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Integers", "\[Rule]", "\"\<I\>\""}], ",", 
                   RowBox[{"Reals", "\[Rule]", "\"\<C\>\""}]}], "}"}]}], 
                ")"}]}], "]"}]}], ",", 
            RowBox[{"MatchQ", "[", 
             RowBox[{"dom", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"Integers", "|", "Reals"}], ")"}], ".."}], "}"}]}], 
             "]"}]}], "}"}]}], "\[IndentingNewLine]", "}"}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"GurobiSolve", "::", "domerror"}], ",", "dom"}], "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"GurobiML`GurobiML`GurobiSolveLowLevel", "[", 
         RowBox[{
         "c", ",", "lb", ",", "ub", ",", "cbeg", ",", " ", "cind", ",", " ", 
          RowBox[{"N", "@", "cval"}], ",", "procRhs", ",", "senses", ",", 
          "procDom"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MatchQ", "[", 
           RowBox[{"#", ",", "_List"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"GurobiSolve", "::", "lowlevelmessage"}], ",", "#"}], 
            "]"}], ";", 
           RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], "&"}], "@", 
       "\[IndentingNewLine]", 
       RowBox[{"Switch", "[", 
        RowBox[{"c", ",", "\[IndentingNewLine]", 
         RowBox[{"_", "?", "MatrixQ"}], ",", "\[IndentingNewLine]", 
         RowBox[{"GurobiML`GurobiML`GurobiSolveLowLevel", "[", 
          RowBox[{
           RowBox[{"Array", "[", 
            RowBox[{
             RowBox[{"0", "&"}], ",", 
             RowBox[{"Length", "[", 
              RowBox[{"Transpose", "[", "m", "]"}], "]"}]}], "]"}], ",", "lb",
            ",", "ub", ",", "cbeg", ",", " ", "cind", ",", " ", 
           RowBox[{"N", "@", "cval"}], ",", "procRhs", ",", "senses", ",", 
           "procDom", ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"matrix2sparse", "[", "c", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"_", "?", "NumberQ"}], ".."}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"GurobiML`GurobiML`GurobiSolveLowLevel", "[", 
          RowBox[{
          "c", ",", "lb", ",", "ub", ",", "cbeg", ",", " ", "cind", ",", " ", 
           
           RowBox[{"N", "@", "cval"}], ",", "procRhs", ",", "senses", ",", 
           "procDom", ",", 
           RowBox[{"(*", "qrow", "*)"}], 
           RowBox[{"{", "}"}], ",", 
           RowBox[{"(*", "qcol", "*)"}], 
           RowBox[{"{", "}"}], ",", 
           RowBox[{"(*", "qval", "*)"}], 
           RowBox[{"{", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"_", "?", "NumberQ"}], ".."}], "}"}], ",", 
           RowBox[{"_", "?", "MatrixQ"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"GurobiML`GurobiML`GurobiSolveLowLevel", "[", 
          RowBox[{
           RowBox[{"c", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "lb", ",", "ub", ",", "cbeg",
            ",", " ", "cind", ",", " ", 
           RowBox[{"N", "@", "cval"}], ",", "procRhs", ",", "senses", ",", 
           "procDom", ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"matrix2sparse", "[", 
             RowBox[{"c", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", "_", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"GurobiSolve", "::", "objerror"}], ",", "c"}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"def", ":", 
   RowBox[{"GurobiSolve", "[", "___", "]"}]}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"GurobiML", "::", "badargs"}], ",", "GurobiSolve", ",", 
      RowBox[{"Defer", "@", "def"}]}], "]"}], ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "GurobiSolve", "]"}], ";"}]}], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "GurobiSolveMinimaMaxima", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolveMinimaMaxima", "::", "rhserror"}], "=", 
   "\"\<Righthand sides `1` are wrongly specified.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolveMinimaMaxima", "::", "bndserror"}], "=", 
   "\"\<Variable bounds `1` are wrongly specified.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolveMinimaMaxima", "::", "domerror"}], "=", 
   "\"\<Problem with domain specification `1`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolveMinimaMaxima", "::", "lowlevelmessage"}], "=", 
   "\"\<Gurobi interface returned the following status: `1`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GurobiSolveMinimaMaxima", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MatrixQ"}], ",", 
     RowBox[{"b", ":", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"_", "?", "NumberQ"}], ".."}], "}"}], "|", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"_", "?", "NumberQ"}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "1"}], "|", 
               RowBox[{"-", "1."}], "|", "0", "|", "0.", "|", "1", "|", 
               "1."}], ")"}]}], "}"}], ".."}], "}"}]}], ")"}], ":", 
       RowBox[{"{", "}"}]}]}], ",", 
     RowBox[{"l", ":", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"_", "?", "NumberQ"}], "|", 
             RowBox[{"-", "\[Infinity]"}], "|", "\[Infinity]"}], ")"}], 
           ".."}], "}"}], "|", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"_", "?", "NumberQ"}], "|", 
               RowBox[{"-", "\[Infinity]"}], "|", "\[Infinity]"}], ")"}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"_", "?", "NumberQ"}], "|", 
               RowBox[{"-", "\[Infinity]"}], "|", "\[Infinity]"}], ")"}]}], 
            "}"}], ".."}], "}"}]}], ")"}], ":", 
       RowBox[{"{", "}"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"dom", ":", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Integers", "|", "Reals", "|", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"Integers", "|", "Reals"}], ")"}], ".."}], "}"}]}], ")"}],
        ":", "Reals"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "procRhs", ",", "procDom", ",", "lb", ",", "ub", ",", "senses", ",", 
       "cbeg", ",", "cind", ",", "cval", ",", "c", ",", "lClean"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"c", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dimensions", "[", "m", "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"cbeg", ",", "cind", ",", "cval"}], "}"}], "=", 
       RowBox[{"matrix2compressedSparseRow", "[", "m", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"senses", "=", "\"\<\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"procRhs", "=", 
             RowBox[{"{", "}"}]}], ",", 
            RowBox[{"b", "\[Equal]", 
             RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"procRhs", "=", "b"}], ",", 
            RowBox[{"MatchQ", "[", 
             RowBox[{"b", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"_", "?", "NumberQ"}], ".."}], "}"}]}], "]"}]}], 
           "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"procRhs", ",", "senses"}], "}"}], "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"b", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
               RowBox[{"StringJoin", "[", 
                RowBox[{"Sequence", "@@", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"b", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "/.", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"0", "|", "0."}], ")"}], "\[Rule]", "\"\<=\>\""}],
                     ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "1"}], "|", 
                    RowBox[{"-", "1."}]}], ")"}], "\[Rule]", "\"\<<\>\""}], 
                    ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "|", "1."}], ")"}], "\[Rule]", 
                    "\"\<>\>\""}]}], "}"}]}], ")"}]}], "]"}]}], "}"}]}], ",", 
            
            RowBox[{"MatchQ", "[", 
             RowBox[{"b", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"_", "?", "NumberQ"}], ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"-", "1"}], "|", 
                    RowBox[{"-", "1."}], "|", "0", "|", "0.", "|", "1", "|", 
                    "1."}], ")"}]}], "}"}], ".."}], "}"}]}], "]"}]}], "}"}]}],
          "\[IndentingNewLine]", "}"}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"GurobiSolveMinimaMaxima", "::", "rhserror"}], ",", "b"}], 
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<RHS: \>\"", ",", "procRhs"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Senses: \>\"", ",", "senses"}], "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"lClean", "=", 
       RowBox[{"l", "/.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "\[Infinity]"}], "\[Rule]", 
           RowBox[{"-", "10000"}]}], ",", 
          RowBox[{"\[Infinity]", "\[Rule]", "10000"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"lb", ",", "ub"}], "}"}], "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", "}"}], ",", 
               RowBox[{"{", "}"}]}], "}"}]}], ",", 
            RowBox[{"lClean", "\[Equal]", 
             RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"lb", ",", "ub"}], "}"}], "=", 
             RowBox[{"{", 
              RowBox[{"lClean", ",", 
               RowBox[{"{", "}"}]}], "}"}]}], ",", 
            RowBox[{"MatchQ", "[", 
             RowBox[{"lClean", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"_", "?", "NumberQ"}], ".."}], "}"}]}], "]"}]}], 
           "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"lb", ",", "ub"}], "}"}], "=", 
             RowBox[{"Transpose", "[", "lClean", "]"}]}], ",", 
            RowBox[{"MatchQ", "[", 
             RowBox[{"lClean", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"_", "?", "NumberQ"}], ",", 
                  RowBox[{"_", "?", "NumberQ"}]}], "}"}], ".."}], "}"}]}], 
             "]"}]}], "}"}]}], "\[IndentingNewLine]", "}"}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"GurobiSolveMinimaMaxima", "::", "bndserror"}], ",", 
          "lClean"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<Lower bounds: \>\"", ",", "lb", ",", "\"\< Upper bounds: \>\"", 
          ",", "ub"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"procDom", "=", "\"\<NULL\>\""}], ",", 
            RowBox[{"dom", "\[Equal]", "Reals"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"procDom", "=", 
             RowBox[{"StringJoin", "[", 
              RowBox[{"Sequence", "@@", 
               RowBox[{"Table", "[", 
                RowBox[{"\"\<I\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"Length", "[", "c", "]"}], "}"}]}], "]"}]}], 
              "]"}]}], ",", 
            RowBox[{"dom", "\[Equal]", "Integers"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"procDom", "=", 
             RowBox[{"StringJoin", "[", 
              RowBox[{"Sequence", "@@", 
               RowBox[{"(", 
                RowBox[{"dom", "/.", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Integers", "\[Rule]", "\"\<I\>\""}], ",", 
                   RowBox[{"Reals", "\[Rule]", "\"\<C\>\""}]}], "}"}]}], 
                ")"}]}], "]"}]}], ",", 
            RowBox[{"MatchQ", "[", 
             RowBox[{"dom", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"Integers", "|", "Reals"}], ")"}], ".."}], "}"}]}], 
             "]"}]}], "}"}]}], "\[IndentingNewLine]", "}"}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"GurobiSolveMinimaMaxima", "::", "domerror"}], ",", "dom"}],
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"GurobiML`GurobiML`GurobiSolveLowLevel", "[", 
         RowBox[{
         "c", ",", "lb", ",", "ub", ",", "cbeg", ",", " ", "cind", ",", " ", 
          RowBox[{"N", "@", "cval"}], ",", "procRhs", ",", "senses", ",", 
          "procDom"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"GurobiML`GurobiML`GurobiSolveMinimaMaximaLowLevel", "[", 
       RowBox[{
       "c", ",", "lb", ",", "ub", ",", "cbeg", ",", " ", "cind", ",", " ", 
        RowBox[{"N", "@", "cval"}], ",", "procRhs", ",", "senses", ",", 
        "procDom"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"def", ":", 
   RowBox[{"GurobiSolveMinimaMaxima", "[", "___", "]"}]}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"GurobiML", "::", "badargs"}], ",", "GurobiSolveMinimaMaxima", 
      ",", 
      RowBox[{"Defer", "@", "def"}]}], "]"}], ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "GurobiSolveMinimaMaxima", "]"}], ";"}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], 
  RowBox[{"(*", 
   RowBox[{"End", " ", "`Private`", " ", 
    RowBox[{"Context", "."}]}], "*)"}]}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.510327331326003*^9, 3.5103273313272667`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.51032731791606*^9, 3.510327317917487*^9}}]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1453, 1075},
WindowMargins->{{Automatic, 88}, {Automatic, 0}},
FrontEndVersion->"8.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (November 6, \
2010)",
StyleDefinitions->"Default.nb"
]

